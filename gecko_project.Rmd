---
title: "gecko_project"
output: pdf_document
date: "2024-11-27"
---


```{r}
# Clear environment before running
rm(list=ls())
```


```{r}
# load functions
source("R/DataManipulation.R")
```


```{r}
#set working directory and read in data
data_raw <-read.csv("data-raw/brno_gecko_dist_data.csv")
print(data_raw)
```


```{r}
zone_list = dm.general_splicer(data_raw, "brno_zone", "zone")
print(names(zone_list))
#print(brno_zones[["brno_zone1"]])

```

```{r}
#divide dataset up by data + zone
zone_date_list = dm.date_splicer(zone_list, "date")
names(zone_date_list)

# optionally remove if no longer needed?
# rm(zone_list)
```



```{r}

zone_date_time_list <- dm.time_splicer(zone_date_list, "time")

#generate datasetlist
#this specifies that the suffix that should be at the end of new datasets is 2 digits an underscore and a letter "XX_a"
#zone_date_time_list <- collect_datasets_to_list("zone", "_\\d{2}_[a-zA-Z]$")
names(zone_date_time_list)
```

```{r}


event_list <- dm.event_splicer(zone_date_time_list, "quadrat")

#make dataset list of all events
#event_list <- collect_datasets_to_list("zone", "_\\d{2}_[a-zA-Z]_[a-zA-Z]\\d{1,2}$")
names(event_list)
```


```{r}

#create filtered event datasets
fltr_event_list <- dm.data_filter(event_list, "gecko_present", "bad_img_qua", 0, 1)
names(fltr_event_list)
```


```{r}

#normalise for length_cm and add to large dataset
norm_fltr_event_list <- dm.general_normaliser(fltr_event_list, "length_cm", "rel_len")

#repeat for svl_cm
norm_fltr_event_list <- dm.general_normaliser(norm_fltr_event_list, "svl_cm", "rel_svl")

#repeat for width_cm
norm_fltr_event_list <- dm.general_normaliser(norm_fltr_event_list, "width_cm", "rel_wid")

#repeat for len_vol_cm3
norm_fltr_event_list <- dm.general_normaliser(norm_fltr_event_list, "len_vol_cm3", "rel_len_vol")

#repeat for svl_vol_cm3
norm_fltr_event_list <- dm.general_normaliser(norm_fltr_event_list, "svl_vol_cm3", "rel_svl_vol")

#repeat for disp_light_cm
norm_fltr_event_list <- dm.general_normaliser(norm_fltr_event_list, "disp_light_cm", "rel_disp")

#repeat for dist_light_cm
norm_fltr_event_list <- dm.general_normaliser(norm_fltr_event_list, "dist_light_cm", "rel_dist")

names(norm_fltr_event_list)
```

```{r}


#rank rel_len and add to large dataset
ranked_norm_fltr_event_list <- dm.general_ranker(norm_fltr_event_list, "rel_len", "len_rank")

#repeat for rel_svl
ranked_norm_fltr_event_list <- dm.general_ranker(ranked_norm_fltr_event_list, "rel_svl", "svl_rank")

#repeat for rel_wid
ranked_norm_fltr_event_list <- dm.general_ranker(ranked_norm_fltr_event_list, "rel_wid", "wid_rank")

#repeat for rel_len_vol
ranked_norm_fltr_event_list <- dm.general_ranker(ranked_norm_fltr_event_list, "rel_len_vol", "len_vol_rank")

#repeat for rel_svl_vol
ranked_norm_fltr_event_list <- dm.general_ranker(ranked_norm_fltr_event_list, "rel_svl_vol", "svl_vol_rank")

#repeat for rel_disp
ranked_norm_fltr_event_list <- dm.general_ranker(ranked_norm_fltr_event_list, "disp_light_cm", "disp_rank")

#repeat for rel_dist
ranked_norm_fltr_event_list <- dm.general_ranker(ranked_norm_fltr_event_list, "dist_light_cm", "dist_rank")

names(ranked_norm_fltr_event_list)

```

```{r}
#check all updated datasets are present and correct in database
ranked_norm_fltr_event_list
```


```{r}

#make list for all night events
fltr_event_night_list <- dm.event_time_compiler(ranked_norm_fltr_event_list, "fltr_zone\\d_\\d{2}_", "_[a-z]\\d{1,2}", "n")
names(fltr_event_night_list)

#make list for all afternoon events
fltr_event_afternoon_list <- dm.event_time_compiler(ranked_norm_fltr_event_list,"fltr_zone\\d_\\d{2}_", "_[a-z]\\d{1,2}", "a")
names(fltr_event_afternoon_list)

#make list for all morning events
fltr_event_morning_list <- dm.event_time_compiler(ranked_norm_fltr_event_list,"fltr_zone\\d_\\d{2}_", "_[a-z]\\d{1,2}", "m")
names(fltr_event_morning_list)
```

```{r}
fltr_event_night_list
```

```{r}
#make plotting function
mega_plotter <- function(datasets, xvar, yvar, xlab, ylab, xlim, ylim, title, colour){
  #initialise plot with point at (0,0)
  plot(0, 0, xlab = xlab, ylab = ylab, xlim=c(0,xlim), ylim=c(0,ylim),main = title, col = 'red')
  #iterate through datasets
  print(datasets)
  for (name in names(datasets)){
    #plot points of all datasets in list
    data = datasets[[name]]
    points(data[[xvar]], data[[yvar]], col = colour)
  }
}

#plot ranked svl vol against raw, relative, and ranked displacement and distance

#displacement
mega_plotter(fltr_event_night_list, "svl_vol_rank", "disp_light_cm", "Ranked SVL volume", "Displacement from light source", 15, 300,"Ranked SVL volume against displacement", 'black')

mega_plotter(fltr_event_night_list, "svl_vol_rank", "rel_disp", "Ranked SVL volume", "Relative displacement from light source", 15, 1, "Ranked SVL volume against relative displacement", 'black')

mega_plotter(fltr_event_night_list, "svl_vol_rank", "disp_rank", "Ranked SVL volume", "Ranked displacement from light source", 15, 15, "Ranked SVL volume against ranked displacement", 'black')

#distance
mega_plotter(fltr_event_night_list, "svl_vol_rank", "dist_light_cm", "Ranked SVL volume", "Distance from light source", 15, 300, "Ranked SVL volume against distance", 'black')

mega_plotter(fltr_event_night_list, "svl_vol_rank", "rel_dist", "Ranked SVL volume", "Relative distance from light source", 15, 1, "Ranked SVL volume against relative distance", 'black')

mega_plotter(fltr_event_night_list, "svl_vol_rank", "dist_rank", "Ranked SVL volume", "Ranked distance from light source", 15, 15, "Ranked SVL volume against ranked distance", 'black')
```
```{r}
#relative SVL vol against raw, relative, ranked displacement and distance

#displacement
mega_plotter(fltr_event_night_list, "rel_svl_vol", "disp_light_cm", "Relative SVL volume", "Displacement from light source", 1, 300,"Relative SVL volume against displacement", 'black')

mega_plotter(fltr_event_night_list, "rel_svl_vol", "rel_disp", "Relative SVL volume", "Relative displacement from light source", 1, 1, "Relative SVL volume against relative displacement", 'black')

mega_plotter(fltr_event_night_list, "rel_svl_vol", "disp_rank", "Relative SVL volume", "Ranked displacement from light source", 1, 15, "Relative SVL volume against ranked displacement", 'black')

#distance
mega_plotter(fltr_event_night_list, "rel_svl_vol", "dist_light_cm", "Relative SVL volume", "Distance from light source", 1, 300, "Relative SVL volume against distance", 'black')

mega_plotter(fltr_event_night_list, "rel_svl_vol", "rel_dist", "Relative SVL volume", "Relative distance from light source", 1, 1, "Relative SVL volume against relative distance", 'black')

mega_plotter(fltr_event_night_list, "rel_svl_vol", "dist_rank", "Relative SVL volume", "Relative distance from light source", 1, 15, "Relative SVL volume against relative distance", 'black')

```
```{r}
multi_plotter <- function(datasets1, datasets2, datasets3, xvar, yvar, xlab, ylab, xlim, ylim, title, colour1, colour2, colour3){
  #call megaplotter function to plot first plot
  mega_plotter(datasets1, xvar, yvar, xlab, ylab, xlim, ylim, title, colour1)
  #check datasets2 exists
  if (is.list(datasets2)){
    #plot 2nd dataset
    for (name in names(datasets2)){
    #plot points of all datasets in list
    data = datasets2[[name]]
    points(data[[xvar]], data[[yvar]], col = colour2)
    }
  }
  else{
      print("no secondary dataset")
  }
  #check datasets3 exists
  if (is.list(datasets3)){
    #plot 2nd dataset
    for (name in names(datasets3)){
    #plot points of all datasets in list
    data = datasets3[[name]]
    points(data[[xvar]], data[[yvar]], col = colour3)
    }
  }
  else{
      print("no secondary dataset")
  }
}

multi_plotter(fltr_event_night_list, fltr_event_afternoon_list, fltr_event_afternoon_list, "svl_vol_rank", "disp_light_cm", "Ranked SVL volume", "Displacement from light source", 15, 300,"Ranked SVL volume against displacement", 'black', 'orange', 'blue')
```
```{r}
multi_plotter2 <- function(datasets1, oth_datasets, xvar, yvar, xlab, ylab, xlim, ylim, title, colour1, colours){
  #call megaplotter function to plot first plot
  mega_plotter(datasets1, xvar, yvar, xlab, ylab, xlim, ylim, title, colour1)
  #check oth_datasets exists
  if (is.list(oth_datasets)){
    # start a counter for i that counts each dataset list read
    i <- 1
    #iterate through list of dataset lists
    for (i in length(oth_datasets)){
      #extract each dataset list from the list of dataset lists
      datasets <- oth_datasets[[i]]
      for (name in names(datasets)){
    #plot points of all datasets in list
    data = datasets[[name]]
    points(data[[xvar]], data[[yvar]], col = colours[i])
      }
      #increase i
      i <- i + 1
  }
    }
    
  else{
      print("no secondary dataset")
  }
}

multi_plotter2(fltr_event_night_list, list(fltr_event_afternoon_list, fltr_event_morning_list), "svl_vol_rank", "disp_light_cm", "Ranked SVL volume", "Displacement from light source", 15, 300,"Ranked SVL volume against displacement", 'black', c('orange', 'blue'))
```


```{r}
list(fltr_event_afternoon_list,fltr_event_morning_list)
```
```{r}
test_list <- list(fltr_zone3_13_n_e1)
print(fltr_zone3_13_n_e1)
print(typeof(fltr_event_night_list))
test_list <- fltr_event_night_list
print(length(test_list))

dad_plotter <- function(datasets, xvar, yvar, xlab, ylab, xlim, ylim, title, colour){
  #initialise plot with point at (0,0)
  plot(0, 0, xlab = xlab, ylab = ylab, xlim=c(xlim,0), ylim=c(0,ylim),main = title, col = 'red')
  #iterate through datasets
  for (data in datasets) {
    points(data[[xvar]], data[[yvar]], col = colour)
  }
}
dad_plotter(test_list, "svl_vol_rank", "disp_light_cm", "Ranked SVL volume", "Displacement from light source", 15, 300,"Ranked SVL volume against displacement", 'black')
```


## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
