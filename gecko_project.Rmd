---
title: "gecko_project"
output: pdf_document
date: "2024-11-27"
---


```{r}
# Clear environment before running
rm(list=ls())
```


```{r}
# load functions
source("R/DataManipulation.R")
source("R/DataPlotter.R")
```


```{r}
#set working directory and read in data
data_raw <-read.csv("data-raw/brno_gecko_dist_data.csv")
print(data_raw)

data_raw2 <- read.csv("data-raw/borneo_data.csv")
print(data_raw2)
```
```{r}
#make new dataset that has outliars removed in lowest error columns (length_cm, svl_cm, disp_light_cm, dist_light_cm)
outrm_data <- dm.outliar.rm(data_raw, c("length_cm","svl_cm","disp_light_cm", "dist_light_cm"))
outrm_data
```
```{r}
#split datasets up into separate dataframes but still contained within a list
zone_list = dm.general_splicer(data_raw, "brno_zone", "zone")
print(names(zone_list))
#print(brno_zones[["brno_zone1"]])

#repeat for data excluding outliars
outrm_zone_list <- dm.general_splicer(outrm_data, "brno_zone", "zone")
print(names(outrm_zone_list))
```

```{r}
#divide dataset up by data + zone
zone_date_list = dm.date_splicer(zone_list, "date")
names(zone_date_list)

#repeat for outliar-removed data
outrm_zone_date_list <- dm.date_splicer(outrm_zone_list, "date")
names(outrm_zone_date_list)
```



```{r}
#split via time + date + zone
zone_date_time_list <- dm.time_splicer(zone_date_list, "time")
names(zone_date_time_list)

#repeat for outliar-removed data
outrm_zone_date_time_list <- dm.time_splicer(outrm_zone_date_list, "time")
names(outrm_zone_date_time_list)
```

```{r}
#split data up into list of dataframes for each event

event_list <- dm.event_splicer(zone_date_time_list, "quadrat")
names(event_list)

#repeat for outliar-removed data
outrm_event_list <- dm.event_splicer(outrm_zone_date_time_list, "quadrat")
names(outrm_event_list)
```


```{r}

#create filtered event datasets
fltr_event_list <- dm.data_filter(event_list, "gecko_present", "bad_img_qua", 0, 1)
names(fltr_event_list)

#repeat for outliar-removed data
outrm_fltr_event_list <- dm.data_filter(outrm_event_list, "gecko_present", "bad_img_qua", 0, 1)
names(outrm_fltr_event_list)
```

```{r}
#define ranking system for each column
# TRUE = highest value is lowest rank
# FALSE = highest value is highest rank
rank_system <-  c("rel_len"=TRUE, "rel_svl"=TRUE, "rel_wid"=TRUE, "rel_len_vol"=TRUE, "rel_svl_vol"=TRUE, "disp_light_cm"=FALSE, "dist_light_cm"=FALSE)

#rank and normalise data simultaneously
ranked_norm_fltr_event_list <- dm.norm_ranker(fltr_event_list, rank_system)

#check all updated datasets are present and correct in database
names(ranked_norm_fltr_event_list)
ranked_norm_fltr_event_list
```

```{r}
#repeat for filtered outliar-removed data
outrm_ranked_norm_fltr_event_list <- dm.norm_ranker(outrm_fltr_event_list, rank_system)

#check all updated datasets are present and correct in database
names(outrm_ranked_norm_fltr_event_list)
outrm_ranked_norm_fltr_event_list
```
```{r}
#normalise and rank unfiltered data using same process
ranked_norm_unfltr_event_list <- dm.norm_ranker(event_list, rank_system)

#check all updated datasets are present and correct in database
names(ranked_norm_unfltr_event_list)
ranked_norm_unfltr_event_list
```
```{r}
#repeat for unfiltered outliar-removed data
outrm_ranked_norm_unfltr_event_list <- dm.norm_ranker(outrm_event_list, rank_system)
names(outrm_ranked_norm_unfltr_event_list)
outrm_ranked_norm_unfltr_event_list
```

```{r}
#reformat data into a big dataset and export to file as csv

#do for filtered datasets
smooshed_data <- dm.smoosher(ranked_norm_fltr_event_list)
write.csv(smooshed_data, "data/smooshed.csv")
smooshed_data

#do for unfiltered datasets
unfltr_smooshed_data <- dm.smoosher(ranked_norm_unfltr_event_list)
write.csv(unfltr_smooshed_data, "data/unfltr_smooshed_data.csv")
unfltr_smooshed_data

#do for filtered outliar-removed datasets
outrm_smooshed_data <- dm.smoosher(outrm_ranked_norm_fltr_event_list)
write.csv(outrm_smooshed_data, "data/outrm_smooshed_data.csv")
outrm_smooshed_data

#do for unfiltered outliar-removed datasets
outrm_unfltr_smooshed_data <- dm.smoosher(outrm_ranked_norm_unfltr_event_list)
write.csv(outrm_unfltr_smooshed_data, "data/outrm_unfltr_smooshed_data.csv")
outrm_unfltr_smooshed_data
```
```{r}
#add column of quadrat type + overwrite csv file
smooshed_data <- dm.quad_type(smooshed_data, "quadrat", "quad_type")
write.csv(smooshed_data, "data/smooshed.csv")
smooshed_data

#repeat for unfiltered data
unfltr_smooshed_data <- dm.quad_type(unfltr_smooshed_data, "quadrat", "quad_type")
write.csv(unfltr_smooshed_data, "data/unfltr_smooshed.csv")
unfltr_smooshed_data

#repeat for filtered outliar-removed data
outrm_smooshed_data <- dm.quad_type(outrm_smooshed_data, "quadrat", "quad_type")
write.csv(outrm_smooshed_data, "data/outrm_smooshed_data.csv")
outrm_smooshed_data

#repeat for unfiltered outliar-removed data
outrm_unfltr_smooshed_data <- dm.quad_type(outrm_unfltr_smooshed_data, "quadrat", "quad_type")
write.csv(outrm_unfltr_smooshed_data,"data/outrm_unfltr_smooshed_data.csv")
outrm_unfltr_smooshed_data
```

```{r}
#plot for filtered data
dp.boxplot(smooshed_data, "svl_vol_cm3", "quad_type","Comparison of size between geckos in different quadrats", "Quadrat type experimental or control", "Gecko")

#t test for boxplot
print("__________________________________________________________")
print("Formal test for significance between control and experimental geckos")
dp.t_test(smooshed_data, "svl_vol_cm3", "quad_type")

dp.plotter(smooshed_data, c("time"), "svl_vol_rank", "disp_light_cm", "Ranked SVL", "Displacement from light source /cm", c(0,10), c(0,300), "Gecko size against displacement separated by")

dp.plotter(smooshed_data, c("time"), "svl_vol_rank", "dist_light_cm", "Ranked SVL", "Distance from light source /cm", c(0,10), c(0,450), "Gecko size against distance separated by")
```
```{r}
#plot for unfiltered data
dp.boxplot(unfltr_smooshed_data, "svl_vol_cm3", "quad_type","Comparison of size between geckos in different quadrats", "Quadrat type experimental or control", "Gecko")

#t test for boxplot
print("__________________________________________________________")
print("Formal test for significance between control and experimental geckos")
dp.t_test(unfltr_smooshed_data, "svl_vol_cm3", "quad_type")

dp.plotter(unfltr_smooshed_data, c("time"), "svl_vol_rank", "disp_light_cm", "Ranked SVL", "Displacement from light source /cm", c(0,10), c(0,300), "Gecko size against displacement separated by")

dp.plotter(smooshed_data, c("time"), "svl_vol_rank", "dist_light_cm", "Ranked SVL", "Distance from light source /cm", c(0,10), c(0,450), "Gecko size against distance separated by")
```
```{r}
#plot for filtered outliar_removed data
dp.boxplot(outrm_smooshed_data, "svl_vol_cm3", "quad_type","Comparison of size between geckos in different quadrats", "Quadrat type experimental or control", "Gecko")

#t test for boxplot
print("__________________________________________________________")
print("Formal test for significance between control and experimental geckos")
dp.t_test(outrm_smooshed_data, "svl_vol_cm3", "quad_type")

dp.plotter(outrm_smooshed_data, c("time"), "svl_vol_rank", "disp_light_cm", "Ranked SVL", "Displacement from light source /cm", c(0,10), c(0,270), "Gecko size against displacement separated by")

dp.plotter(outrm_smooshed_data, c("time"), "svl_vol_rank", "dist_light_cm", "Ranked SVL", "Distance from light source /cm", c(0,10), c(0,300), "Gecko size against distance separated by")
```
```{r}
#plot for filtered outliar_removed data
dp.boxplot(outrm_unfltr_smooshed_data, "svl_vol_cm3", "quad_type","Comparison of size between geckos in different quadrats", "Quadrat type experimental or control", "Gecko")

#t test for boxplot
print("__________________________________________________________")
print("Formal test for significance between control and experimental geckos")
dp.t_test(outrm_unfltr_smooshed_data, "svl_vol_cm3", "quad_type")

dp.plotter(outrm_unfltr_smooshed_data, c("time"), "svl_vol_rank", "disp_light_cm", "Ranked SVL", "Displacement from light source /cm", c(0,10), c(0,270), "Gecko size against displacement separated by")

dp.plotter(outrm_unfltr_smooshed_data, c("time"), "svl_vol_rank", "dist_light_cm", "Ranked SVL", "Distance from light source /cm", c(0,10), c(0,300), "Gecko size against distance separated by")
```
```{r}
#vector of column names
abd_colnam <- c("light_int","rli","temp","h_gecko","f_gecko","gek_num","gek_photo","lepid_t","lepid_s","lepid_m","lepid_l","hymen_t",	"hymen_s",	"hymen_m",	"hymen_l",	"hemip_t",	"hemip_s",	"hemip_m",	"hemip_l",	"coleo_t",	"coleo_s",	"coleo_m",	"coleo_l",	"ortho_t",	"ortho_s",	"ortho_m",	"ortho_l",	"odon_t",	"odon_s",	"odon_m",	"odon_l",	"dipt_t",	"dipt_s",	"dipt_m",	"dipt_l",	"other_t",	"other_s",	"other_m",	"other_l",	"arach_t",	"arach_s",	"arach_m",	"arach_l") 
clean_abd_data <- dm.cleaner(data_raw2, abd_colnam)

#add a column with logorithms of relative light intesnity
clean_abd_data <- dm.log_col(clean_abd_data, "light_int", "log_light")
write.csv(clean_abd_data, "data/clean_abd_data.csv")
clean_abd_data
```
```{r}
# Abundance data analysis
print(max(clean_abd_data$rli, na.rm=TRUE))
dp.plotter(clean_abd_data, c("time"), "log_light", "gek_num", "Log light intensity of quadrat relative to ambient", "Gecko abundance in quadrat", c(0,9), c(0,10), "Gecko abundance separated by")
```



