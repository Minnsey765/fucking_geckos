---
title: "gecko_project"
output: pdf_document
date: "2024-11-27"
---


```{r}
# Clear environment before running
rm(list=ls())
```


```{r}
# load functions
source("R/DataManipulation.R")
source("R/DataPlotter.R")
```


```{r}
#set working directory and read in data
data_raw <-read.csv("data-raw/brno_gecko_dist_data.csv")
print(data_raw)
```


```{r}
zone_list = dm.general_splicer(data_raw, "brno_zone", "zone")
print(names(zone_list))
#print(brno_zones[["brno_zone1"]])

```

```{r}
#divide dataset up by data + zone
zone_date_list = dm.date_splicer(zone_list, "date")
names(zone_date_list)

# optionally remove if no longer needed?
# rm(zone_list)
```



```{r}

zone_date_time_list <- dm.time_splicer(zone_date_list, "time")

#generate datasetlist
#this specifies that the suffix that should be at the end of new datasets is 2 digits an underscore and a letter "XX_a"
#zone_date_time_list <- collect_datasets_to_list("zone", "_\\d{2}_[a-zA-Z]$")
names(zone_date_time_list)
```

```{r}


event_list <- dm.event_splicer(zone_date_time_list, "quadrat")

#make dataset list of all events
#event_list <- collect_datasets_to_list("zone", "_\\d{2}_[a-zA-Z]_[a-zA-Z]\\d{1,2}$")
names(event_list)
```


```{r}

#create filtered event datasets
fltr_event_list <- dm.data_filter(event_list, "gecko_present", "bad_img_qua", 0, 1)
names(fltr_event_list)
```

```{r}
#define ranking system for each column
# TRUE = highest value is lowest rank
# FALSE = highest value is highest rank
rank_system <-  c("rel_len"=TRUE, "rel_svl"=TRUE, "rel_wid"=TRUE, "rel_len_vol"=TRUE, "rel_svl_vol"=TRUE, "disp_light_cm"=FALSE, "dist_light_cm"=FALSE)

#rank and normalise data simultaneously
ranked_norm_fltr_event_list <- dm.norm_ranker(fltr_event_list, rank_system)

```

```{r}
#check all updated datasets are present and correct in database
names(ranked_norm_fltr_event_list)
ranked_norm_fltr_event_list
```
```{r}
#normalise and rank unfiltered data using same process
ranked_norm_unfltr_event_list <- dm.norm_ranker(event_list, rank_system)
```
```{r}
#check all updated datasets are present and correct in database
names(ranked_norm_unfltr_event_list)
ranked_norm_unfltr_event_list
```

```{r}
#reformat data into a big dataset and export to file as csv

#do for filtered datasets
smooshed_data <- dm.smoosher(ranked_norm_fltr_event_list)
write.csv(smooshed_data, "data/smooshed.csv")
smooshed_data

#do for unfiltered datasets
unfltr_smooshed_data <- dm.smoosher(ranked_norm_unfltr_event_list)
write.csv(unfltr_smooshed_data, "data/unfltr_smooshed_data.csv")
unfltr_smooshed_data
```
```{r}
#add column of quadrat type + overwrite csv file
smooshed_data <- dm.quad_type(smooshed_data, "quadrat", "quad_type")
write.csv(smooshed_data, "data/smooshed.csv")
smooshed_data

#repeat for unfiltered data
unfltr_smooshed_data <- dm.quad_type(unfltr_smooshed_data, "quadrat", "quad_type")
write.csv(unfltr_smooshed_data, "data/unfltr_smooshed.csv")
unfltr_smooshed_data
```


```{r}
dp.plotter(smooshed_data, c("time"), "svl_vol_rank", "disp_light_cm", "Ranked SVL", "Displacement from light source /cm", c(0,10), c(0,300), "Gecko size against displacement separated by")

dp.plotter(smooshed_data, c("time"), "svl_vol_rank", "dist_light_cm", "Ranked SVL", "Distance from light source /cm", c(0,10), c(0,450), "Gecko size against distance separated by")
```
```{r}
dp.plotter(unfltr_smooshed_data, c("time"), "svl_vol_rank", "disp_light_cm", "Ranked SVL", "Displacement from light source /cm", c(0,10), c(0,300), "Gecko size against displacement separated by")

dp.plotter(smooshed_data, c("time"), "svl_vol_rank", "dist_light_cm", "Ranked SVL", "Distance from light source /cm", c(0,10), c(0,450), "Gecko size against distance separated by")
```


